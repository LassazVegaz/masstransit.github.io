(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{303:function(t,a,e){"use strict";e.r(a);var s=e(10),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"activities"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activities"}},[t._v("#")]),t._v(" Activities")]),t._v(" "),a("p",[t._v("In MassTransit Courier, an "),a("em",[t._v("Activity")]),t._v(" refers to a processing step that can be added to a routing slip.")]),t._v(" "),a("p",[t._v("To create an activity, create a class that implements the "),a("em",[t._v("IActivity")]),t._v(" interface.")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DownloadImageActivity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IActivity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("DownloadImageArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DownloadImageLog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ExecutionResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecuteContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("DownloadImageArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("CompensationResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Compensate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompensateContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("DownloadImageLog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The "),a("em",[t._v("IActivity")]),t._v(" interface is generic with two arguments. The first parameter specifies the activity’s argument type and the second parameter specifies the activity’s log type. In the example shown above, "),a("em",[t._v("DownloadImageArguments")]),t._v(" is the argument type and "),a("em",[t._v("DownloadImageLog")]),t._v(" is the log type. Both parameters may be interface, class or record types. Where the type is a class or a record, the proper accessors should be specified (i.e. "),a("code",[t._v("{ get; set; }")]),t._v(" or "),a("code",[t._v("{ get; init; }")]),t._v(").")]),t._v(" "),a("h2",{attrs:{id:"execute-activities"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#execute-activities"}},[t._v("#")]),t._v(" Execute Activities")]),t._v(" "),a("p",[t._v("An "),a("em",[t._v("Execute Activity")]),t._v(" is an activity that only executes and does not support compensation. As such, the declaration of a log type is not required.")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValidateImageActivity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IExecuteActivity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ValidateImageArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ExecutionResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecuteContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ValidateImageArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"implementing-an-activity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementing-an-activity"}},[t._v("#")]),t._v(" Implementing an activity")]),t._v(" "),a("p",[t._v("An activity must implement two interface methods, "),a("em",[t._v("Execute")]),t._v(" and "),a("em",[t._v("Compensate")]),t._v(". The "),a("em",[t._v("Execute")]),t._v(" method is called while the routing slip is executing activities and the "),a("em",[t._v("Compensate")]),t._v(" method is called when a routing slip faults and needs to be compensated.")]),t._v(" "),a("p",[t._v("When the "),a("em",[t._v("Execute")]),t._v(" method is called, an "),a("em",[t._v("execution")]),t._v(" argument is passed containing the activity arguments, the routing slip "),a("em",[t._v("TrackingNumber")]),t._v(", and methods to mark the activity as completed or faulted. The actual routing slip message, as well as any details of the underlying infrastructure, are excluded from the "),a("em",[t._v("execution")]),t._v(" argument to prevent coupling between the activity and the implementation. An example "),a("em",[t._v("Execute")]),t._v(" method is shown below.")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ExecutionResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecuteContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("DownloadImageArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" execution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DownloadImageArguments")]),t._v(" args "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" execution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Arguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" imageSavePath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Combine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WorkPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        execution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TrackingNumber"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" _httpClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetAndSave")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ImageUri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" imageSavePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" execution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token generic-method"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Completed")]),a("span",{pre:!0,attrs:{class:"token generic class-name"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("DownloadImageLog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ImageSavePath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" imageSavePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"completing-an-activity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#completing-an-activity"}},[t._v("#")]),t._v(" Completing an activity")]),t._v(" "),a("p",[t._v("Once activity processing is complete, the activity returns an "),a("em",[t._v("ExecutionResult")]),t._v(" to the host. If the activity executes successfully, the activity can elect to store compensation data in an activity log which is passed to the "),a("em",[t._v("Completed")]),t._v(" method on the "),a("em",[t._v("execution")]),t._v(" argument. If the activity chooses not to store any compensation data, the activity log argument is not required. In addition to compensation data, the activity can add or modify variables stored in the routing slip for use by subsequent activities.")]),t._v(" "),a("blockquote",[a("p",[t._v("In the example above, the activity specifies the "),a("em",[t._v("DownloadImageLog")]),t._v(" interface and initializes the log using an anonymous object. The object is then passed to the "),a("em",[t._v("Completed")]),t._v(" method for storage in the routing slip before sending the routing slip to the next activity.")])]),t._v(" "),a("h2",{attrs:{id:"terminating-a-routing-slip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#terminating-a-routing-slip"}},[t._v("#")]),t._v(" Terminating a routing slip")]),t._v(" "),a("p",[t._v("In some situations, it may make sense to terminate the routing slip without executing any of the subsequent activities in the itinerary. This might be due to a business rule, in which the routing slip shouldn't be faulted, but needs to end immediately.")]),t._v(" "),a("p",[t._v("To terminate a routing slip, call "),a("em",[t._v("Terminate")]),t._v(" as shown.")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// regular termination")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" execution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Terminate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// terminate and include additional variables in the event")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" execution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Terminate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Reason "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Not a good time, dude."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"faulting-a-routing-slip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#faulting-a-routing-slip"}},[t._v("#")]),t._v(" Faulting a routing slip")]),t._v(" "),a("p",[t._v("By default, if an activity throws an exception, it will be "),a("em",[t._v("faulted")]),t._v(" and a "),a("code",[t._v("RoutingSlipFaulted")]),t._v(" event will be published (unless a subscription changes the rules). An activity can also return "),a("em",[t._v("Faulted")]),t._v(" rather than throwing an exception.")]),t._v(" "),a("h2",{attrs:{id:"compensating-an-activity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compensating-an-activity"}},[t._v("#")]),t._v(" Compensating an activity")]),t._v(" "),a("p",[t._v("When an activity fails, the "),a("em",[t._v("Compensate")]),t._v(" method is called for previously executed activities in the routing slip that stored compensation data. If an activity does not store any compensation data, the "),a("em",[t._v("Compensate")]),t._v(" method is never called. The compensation method for the example above is shown below.")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("CompensationResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Compensate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompensateContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("DownloadImageLog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" compensation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DownloadImageLog")]),t._v(" log "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" compensation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    File"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ImageSavePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" compensation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Compensated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Using the activity log data, the activity compensates by removing the downloaded image from the work directory. Once the activity has compensated the previous execution, it returns a "),a("em",[t._v("CompensationResult")]),t._v(" by calling the "),a("em",[t._v("Compensated")]),t._v(" method. If the compensating actions could not be performed (either via logic or an exception) and the inability to compensate results in a failure state, the "),a("em",[t._v("Failed")]),t._v(" method can be used instead, optionally specifying an "),a("em",[t._v("Exception")]),t._v(".")])])}),[],!1,null,null,null);a.default=n.exports}}]);