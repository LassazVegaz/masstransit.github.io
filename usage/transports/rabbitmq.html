<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ | MassTransit</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.10d3c714.css" as="style"><link rel="preload" href="/assets/js/app.0285a886.js" as="script"><link rel="preload" href="/assets/js/3.ed085c94.js" as="script"><link rel="preload" href="/assets/js/144.8a4c62e1.js" as="script"><link rel="prefetch" href="/assets/js/10.4664b18e.js"><link rel="prefetch" href="/assets/js/100.521eb47e.js"><link rel="prefetch" href="/assets/js/101.6dc69973.js"><link rel="prefetch" href="/assets/js/102.6bddc9f5.js"><link rel="prefetch" href="/assets/js/103.221a5e32.js"><link rel="prefetch" href="/assets/js/104.7a9d3561.js"><link rel="prefetch" href="/assets/js/105.992a55d5.js"><link rel="prefetch" href="/assets/js/106.bb89b0bb.js"><link rel="prefetch" href="/assets/js/107.c91fea02.js"><link rel="prefetch" href="/assets/js/108.6224e0f4.js"><link rel="prefetch" href="/assets/js/109.39b59e40.js"><link rel="prefetch" href="/assets/js/11.e65fb4dd.js"><link rel="prefetch" href="/assets/js/110.dae634e5.js"><link rel="prefetch" href="/assets/js/111.4c889386.js"><link rel="prefetch" href="/assets/js/112.e87e3bb4.js"><link rel="prefetch" href="/assets/js/113.c82496c0.js"><link rel="prefetch" href="/assets/js/114.1196b6b6.js"><link rel="prefetch" href="/assets/js/115.f9c3be75.js"><link rel="prefetch" href="/assets/js/116.86a98031.js"><link rel="prefetch" href="/assets/js/117.4e172665.js"><link rel="prefetch" href="/assets/js/118.f955d9b2.js"><link rel="prefetch" href="/assets/js/119.7ba6c616.js"><link rel="prefetch" href="/assets/js/12.a3fdfa3d.js"><link rel="prefetch" href="/assets/js/120.1500a82c.js"><link rel="prefetch" href="/assets/js/121.49da4f03.js"><link rel="prefetch" href="/assets/js/122.1447c040.js"><link rel="prefetch" href="/assets/js/123.3eba400d.js"><link rel="prefetch" href="/assets/js/124.11e37f2a.js"><link rel="prefetch" href="/assets/js/125.c0d86ef4.js"><link rel="prefetch" href="/assets/js/126.92057799.js"><link rel="prefetch" href="/assets/js/127.268c2774.js"><link rel="prefetch" href="/assets/js/128.3e18db43.js"><link rel="prefetch" href="/assets/js/129.5a12693a.js"><link rel="prefetch" href="/assets/js/13.a1e1950a.js"><link rel="prefetch" href="/assets/js/130.16a342ad.js"><link rel="prefetch" href="/assets/js/131.c3635c42.js"><link rel="prefetch" href="/assets/js/132.de6b0df7.js"><link rel="prefetch" href="/assets/js/133.7179d94d.js"><link rel="prefetch" href="/assets/js/134.e15fa251.js"><link rel="prefetch" href="/assets/js/135.8cf6c306.js"><link rel="prefetch" href="/assets/js/136.364d6d81.js"><link rel="prefetch" href="/assets/js/137.38b29357.js"><link rel="prefetch" href="/assets/js/138.b7495e25.js"><link rel="prefetch" href="/assets/js/139.ec45975e.js"><link rel="prefetch" href="/assets/js/14.ffd071f1.js"><link rel="prefetch" href="/assets/js/140.e19ba9e8.js"><link rel="prefetch" href="/assets/js/141.bd5bd66c.js"><link rel="prefetch" href="/assets/js/142.cc367b50.js"><link rel="prefetch" href="/assets/js/143.93a7c6d9.js"><link rel="prefetch" href="/assets/js/15.bb6e1b74.js"><link rel="prefetch" href="/assets/js/16.9ffaa291.js"><link rel="prefetch" href="/assets/js/17.232013c5.js"><link rel="prefetch" href="/assets/js/18.ad084001.js"><link rel="prefetch" href="/assets/js/19.3da9ad58.js"><link rel="prefetch" href="/assets/js/20.d1fad9d8.js"><link rel="prefetch" href="/assets/js/21.f87865b3.js"><link rel="prefetch" href="/assets/js/22.af0a9f2e.js"><link rel="prefetch" href="/assets/js/23.e2d8f51a.js"><link rel="prefetch" href="/assets/js/24.e6d92251.js"><link rel="prefetch" href="/assets/js/25.4a62dbc7.js"><link rel="prefetch" href="/assets/js/26.46955a2d.js"><link rel="prefetch" href="/assets/js/27.e5f38990.js"><link rel="prefetch" href="/assets/js/28.f4311d18.js"><link rel="prefetch" href="/assets/js/29.5b5eab97.js"><link rel="prefetch" href="/assets/js/30.2799302d.js"><link rel="prefetch" href="/assets/js/31.ed423d27.js"><link rel="prefetch" href="/assets/js/32.5d6eeef0.js"><link rel="prefetch" href="/assets/js/33.150a8095.js"><link rel="prefetch" href="/assets/js/34.7d42cc21.js"><link rel="prefetch" href="/assets/js/35.063c255c.js"><link rel="prefetch" href="/assets/js/36.15cef90f.js"><link rel="prefetch" href="/assets/js/37.8a6e504b.js"><link rel="prefetch" href="/assets/js/38.bee623db.js"><link rel="prefetch" href="/assets/js/39.c6419725.js"><link rel="prefetch" href="/assets/js/4.7df36a6c.js"><link rel="prefetch" href="/assets/js/40.ce1e8e7b.js"><link rel="prefetch" href="/assets/js/41.343d67f5.js"><link rel="prefetch" href="/assets/js/42.5359f115.js"><link rel="prefetch" href="/assets/js/43.4eab0ad4.js"><link rel="prefetch" href="/assets/js/44.4aaaa1e9.js"><link rel="prefetch" href="/assets/js/45.9f062233.js"><link rel="prefetch" href="/assets/js/46.029a65d8.js"><link rel="prefetch" href="/assets/js/47.5e86e2ab.js"><link rel="prefetch" href="/assets/js/48.a9824b7a.js"><link rel="prefetch" href="/assets/js/49.95f68b0a.js"><link rel="prefetch" href="/assets/js/5.edf7f764.js"><link rel="prefetch" href="/assets/js/50.14766090.js"><link rel="prefetch" href="/assets/js/51.288d4268.js"><link rel="prefetch" href="/assets/js/52.145258d7.js"><link rel="prefetch" href="/assets/js/53.cfedf356.js"><link rel="prefetch" href="/assets/js/54.b219bb82.js"><link rel="prefetch" href="/assets/js/55.0f092b8d.js"><link rel="prefetch" href="/assets/js/56.94b4efb7.js"><link rel="prefetch" href="/assets/js/57.f5b797bf.js"><link rel="prefetch" href="/assets/js/58.f75104cf.js"><link rel="prefetch" href="/assets/js/59.bf8ec211.js"><link rel="prefetch" href="/assets/js/6.8e720dfb.js"><link rel="prefetch" href="/assets/js/60.87367e7f.js"><link rel="prefetch" href="/assets/js/61.b0df016b.js"><link rel="prefetch" href="/assets/js/62.445689cc.js"><link rel="prefetch" href="/assets/js/63.d13ef97e.js"><link rel="prefetch" href="/assets/js/64.75046760.js"><link rel="prefetch" href="/assets/js/65.afd3aea1.js"><link rel="prefetch" href="/assets/js/66.9199174c.js"><link rel="prefetch" href="/assets/js/67.68979a22.js"><link rel="prefetch" href="/assets/js/68.7dc6533f.js"><link rel="prefetch" href="/assets/js/69.05b365c2.js"><link rel="prefetch" href="/assets/js/7.d411127e.js"><link rel="prefetch" href="/assets/js/70.2bea9937.js"><link rel="prefetch" href="/assets/js/71.a0c02df1.js"><link rel="prefetch" href="/assets/js/72.9bcafbd2.js"><link rel="prefetch" href="/assets/js/73.7e27fb04.js"><link rel="prefetch" href="/assets/js/74.2e777193.js"><link rel="prefetch" href="/assets/js/75.01d5b44f.js"><link rel="prefetch" href="/assets/js/76.439d5b29.js"><link rel="prefetch" href="/assets/js/77.2326a3bf.js"><link rel="prefetch" href="/assets/js/78.0490ab0d.js"><link rel="prefetch" href="/assets/js/79.eb31d268.js"><link rel="prefetch" href="/assets/js/8.4cdb2372.js"><link rel="prefetch" href="/assets/js/80.87ffba09.js"><link rel="prefetch" href="/assets/js/81.96fe4f52.js"><link rel="prefetch" href="/assets/js/82.1071de63.js"><link rel="prefetch" href="/assets/js/83.4fcf2a50.js"><link rel="prefetch" href="/assets/js/84.668ce9b6.js"><link rel="prefetch" href="/assets/js/85.0cd583fb.js"><link rel="prefetch" href="/assets/js/86.25f53ebc.js"><link rel="prefetch" href="/assets/js/87.81494f85.js"><link rel="prefetch" href="/assets/js/88.7d618ad5.js"><link rel="prefetch" href="/assets/js/89.ad90e21c.js"><link rel="prefetch" href="/assets/js/9.307c805f.js"><link rel="prefetch" href="/assets/js/90.5761e417.js"><link rel="prefetch" href="/assets/js/91.74a77aa9.js"><link rel="prefetch" href="/assets/js/92.cce73881.js"><link rel="prefetch" href="/assets/js/93.2c2c17c3.js"><link rel="prefetch" href="/assets/js/94.f5c6b161.js"><link rel="prefetch" href="/assets/js/95.6160e31e.js"><link rel="prefetch" href="/assets/js/96.0fa9288b.js"><link rel="prefetch" href="/assets/js/97.50cbe0f3.js"><link rel="prefetch" href="/assets/js/98.9c42acd8.js"><link rel="prefetch" href="/assets/js/99.d7d2a3cd.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4ad889dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.10d3c714.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/getting-started/live-coding.html" class="sidebar-link">Live Coding</a></li><li><a href="/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/releases/" class="sidebar-heading clickable"><span>Release Notes</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/usage/" class="sidebar-heading clickable router-link-active open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/transports/" class="sidebar-heading clickable router-link-active open"><span>Transports</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/transports/rabbitmq.html" aria-current="page" class="active sidebar-link">RabbitMQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/usage/transports/rabbitmq.html#broker-topology" class="sidebar-link">Broker Topology</a></li><li class="sidebar-sub-header"><a href="/usage/transports/rabbitmq.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/usage/transports/rabbitmq.html#cloudamqp" class="sidebar-link">CloudAMQP</a></li><li class="sidebar-sub-header"><a href="/usage/transports/rabbitmq.html#amazonmq-rabbitmq" class="sidebar-link">AmazonMQ - RabbitMQ</a></li><li class="sidebar-sub-header"><a href="/usage/transports/rabbitmq.html#guidance" class="sidebar-link">Guidance</a></li></ul></li><li><a href="/usage/transports/azure-sb.html" class="sidebar-link">Azure Service Bus</a></li><li><a href="/usage/transports/activemq.html" class="sidebar-link">ActiveMQ</a></li><li><a href="/usage/transports/amazonsqs.html" class="sidebar-link">Amazon SQS</a></li><li><a href="/usage/transports/in-memory.html" class="sidebar-link">In Memory</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/riders/" class="sidebar-heading clickable"><span>Riders</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/mediator.html" class="sidebar-link">Mediator</a></li><li><a href="/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/testing.html" class="sidebar-link">Testing</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Articles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/platform/" class="sidebar-heading clickable"><span>Platform</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> RabbitMQ</h1> <blockquote><p><a href="https://nuget.org/packages/MassTransit.RabbitMQ/" target="_blank" rel="noopener noreferrer">MassTransit.RabbitMQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>With tens of thousands of users, RabbitMQ is one of the most popular open source message brokers. RabbitMQ is lightweight and easy to deploy on premises and in the cloud. RabbitMQ can be deployed in distributed and federated configurations to meet high-scale, high-availability requirements.</p> <p>MassTransit fully supports RabbitMQ, including many of the advanced features and capabilities.</p> <div class="custom-block tip"><p class="custom-block-title">Getting Started</p> <p>To get started with RabbitMQ, refer to the <a href="/usage/configuration">configuration</a> section which uses RabbitMQ in the examples.</p></div> <h2 id="broker-topology"><a href="#broker-topology" class="header-anchor">#</a> Broker Topology</h2> <p>With RabbitMQ, which supports exchanges and queues, messages are <em>sent</em> or <em>published</em> to exchanges and RabbitMQ routes those messages through exchanges to the appropriate queues.</p> <p>In the example below, which configures a receive endpoint, consumer, and message type, the bus is configured to use RabbitMQ.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">OrderSystem<span class="token punctuation">.</span>Events</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderSubmitted</span>
    <span class="token punctuation">{</span>
        <span class="token return-type class-name">Guid</span> OrderId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">namespace</span> <span class="token namespace">RabbitMqConsoleListener</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">OrderSystem<span class="token punctuation">.</span>Events</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> h <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    h<span class="token punctuation">.</span><span class="token function">Username</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    h<span class="token punctuation">.</span><span class="token function">Password</span><span class="token punctuation">(</span><span class="token string">&quot;guest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;order-events-listener&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Consumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderSubmittedEventConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Press enter to exit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">finally</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">class</span> <span class="token class-name">OrderSubmittedEventConsumer</span> <span class="token punctuation">:</span>
            <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>OrderSubmitted<span class="token punctuation">&gt;</span></span></span>
        <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>OrderSubmitted<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Order Submitted: {0}&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The configuration includes:</p> <ul><li>The RabbitMQ host
<ul><li>Host name: <code>localhost</code></li> <li>Virtual host: <code>/</code></li> <li>User name and password used to connect to the virtual host (credentials are virtual-host specific)</li></ul></li> <li>The receive endpoint
<ul><li>Queue name: <code>order-events-listener</code></li> <li>Consumer: <code>OrderSubmittedEventConsumer</code> <ul><li>Message type: <code>OrderSystem.Events.OrderSubmitted</code></li></ul></li></ul></li></ul> <p>When the bus is started, MassTransit will create exchanges and queues on the virtual host for the receive endpoint. MassTransit creates durable, <em>fanout</em> exchanges by default, and queues are also durable by default.</p> <table><thead><tr><th style="text-align:left;">Name</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">order-events-listener</td> <td style="text-align:left;">Queue for the receive endpoint</td></tr> <tr><td style="text-align:left;">order-events-listener</td> <td style="text-align:left;">An exchange, bound to the queue, used to <em>send</em> messages</td></tr> <tr><td style="text-align:left;">OrderSystem.Events:OrderSubmitted</td> <td style="text-align:left;">An exchange, named by the message-type, bound to the <em>order-events-listener</em> exchange, used to <em>publish</em> messages</td></tr></tbody></table> <p>When a message is sent, the endpoint address can be one of two values:</p> <p><code>exchange:order-events-listener</code></p> <p>Send the message to the <em>order-events-listener</em> exchange. If the exchange does not exist, it will be created. <em>MassTransit translates topic: to exchange: when using RabbitMQ, so that topic: addresses can be resolved – since RabbitMQ is the only supported transport that doesn't have topics.</em></p> <p><code>queue:order-events-listener</code></p> <p>Send the message to the <em>order-events-listener</em> exchange. If the exchange or queue does not exist, they will be created and the exchange will be bound to the queue.</p> <p>With either address, RabbitMQ will route the message from the <em>order-events-listener</em> exchange to the <em>order-events-listener</em> queue.</p> <p>When a message is published, the message is sent to the <em>OrderSystem.Events:OrderSubmitted</em> exchange. If the exchange does not exist, it will be created. RabbitMQ will route the message from the <em>OrderSystem.Events:OrderSubmitted</em> exchange to the <em>order-events-listener</em> exchange, and subsequently to the <em>order-events-listener</em> queue. If other receive endpoints connected to the same virtual host include consumers that consume the <em>OrderSubmitted</em> message, a copy of the message would be routed to each of those endpoints as well.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If a message is published before starting the bus, so that MassTransit can create the exchanges and queues, the exchange <em>OrderSystem.Events:OrderSubmitted</em> will be created. However, until the bus has been started at least once, there won't be a queue bound to the exchange and any published messages will be lost. Once the bus has been started, the queue will remain bound to the exchange even when the bus is stopped.</p></div> <p>Durable exchanges and queues remain configured on the virtual host, so even if the bus is stopped messages will continue to be routed to the queue. When the bus is restarted, queued messages will be consumed.</p> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <p>MassTransit includes several host-level configuration options that control the behavior for the entire bus.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>PublisherConfirmation</td> <td>bool</td> <td>MassTransit will wait until RabbitMQ confirms messages when publishing or sending messages (default: true)</td></tr> <tr><td>Heartbeat</td> <td>TimeSpan</td> <td>The heartbeat interval used by the RabbitMQ client to keep the connection alive</td></tr> <tr><td>RequestedChannelMax</td> <td>ushort</td> <td>The maximum number of channels allowed on the connection</td></tr> <tr><td>RequestedConnectionTimeout</td> <td>TimeSpan</td> <td>The connection timeout</td></tr></tbody></table> <h4 id="usecluster"><a href="#usecluster" class="header-anchor">#</a> UseCluster</h4> <p>MassTransit can connect to a cluster of RabbitMQ virtual hosts and treat them as a single virtual host. To configure a cluster, call the <code>UseCluster</code> methods, and add the cluster nodes, each of which becomes part of the virtual host identified by the host name. Each cluster node can specify either a <code>host</code> or a <code>host:port</code> combination.</p> <h4 id="configurebatch"><a href="#configurebatch" class="header-anchor">#</a> ConfigureBatch</h4> <p>MassTransit will briefly buffer messages before sending them to RabbitMQ, to increase message throughput. While use of the default values is recommended, the batch options can be configured.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td>Enabled</td> <td>bool</td> <td>true</td> <td>Enable or disable batch sends to RabbitMQ</td></tr> <tr><td>MessageLimit</td> <td>int</td> <td>100</td> <td>Limit the number of messages per batch</td></tr> <tr><td>SizeLimit</td> <td>int</td> <td>64K</td> <td>A rough limit of the total message size</td></tr> <tr><td>Timeout</td> <td>TimeSpan</td> <td>4ms</td> <td>The time to wait for additional messages before sending</td></tr></tbody></table> <p>MassTransit includes several receive endpoint level configuration options that control receive endpoint behavior.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>PrefetchCount</td> <td>ushort</td> <td>The number of unacknowledged messages that can be processed concurrently (default based on CPU count)</td></tr> <tr><td>PurgeOnStartup</td> <td>bool</td> <td>Removes all messages from the queue when the bus is started (default: false)</td></tr> <tr><td>AutoDelete</td> <td>bool</td> <td>If true, the queue will be automatically deleted when the bus is stopped (default: false)</td></tr> <tr><td>Durable</td> <td>bool</td> <td>If true, messages are persisted to disk before being acknowledged (default: true)</td></tr></tbody></table> <h2 id="cloudamqp"><a href="#cloudamqp" class="header-anchor">#</a> CloudAMQP</h2> <p>MassTransit can be used with CloudAMQP, which is a great SaaS-based solution to host your RabbitMQ broker. To configure MassTransit, the host and virtual host must be specified, and <em>UseSsl</em> must be configured.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">CloudAmqpConsoleListener</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Authentication</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token string">&quot;wombat.rmq.cloudamqp.com&quot;</span><span class="token punctuation">,</span> <span class="token number">5671</span><span class="token punctuation">,</span> <span class="token string">&quot;your_vhost&quot;</span><span class="token punctuation">,</span> h <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    h<span class="token punctuation">.</span><span class="token function">Username</span><span class="token punctuation">(</span><span class="token string">&quot;your_vhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    h<span class="token punctuation">.</span><span class="token function">Password</span><span class="token punctuation">(</span><span class="token string">&quot;your_password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    h<span class="token punctuation">.</span><span class="token function">UseSsl</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
                    <span class="token punctuation">{</span>
                        s<span class="token punctuation">.</span>Protocol <span class="token operator">=</span> SslProtocols<span class="token punctuation">.</span>Tls12<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="amazonmq-rabbitmq"><a href="#amazonmq-rabbitmq" class="header-anchor">#</a> AmazonMQ - RabbitMQ</h2> <p>AmazonMQ now includes <a href="https://us-east-2.console.aws.amazon.com/amazon-mq/home" target="_blank" rel="noopener noreferrer">RabbitMQ support<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which means the best message broker can now be used easily on AWS. To configure MassTransit, the AMQPS endpoint address can be used to configure the host as shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">AmazonRabbitMqConsoleListener</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Authentication</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;amqps://b-12345678-1234-1234-1234-123456789012.mq.us-east-2.amazonaws.com:5671&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> h <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    h<span class="token punctuation">.</span><span class="token function">Username</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    h<span class="token punctuation">.</span><span class="token function">Password</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="guidance"><a href="#guidance" class="header-anchor">#</a> Guidance</h2> <p>The following recommendations should be considered <em>best practices</em> for building applications using MassTransit, specifically with RabbitMQ.</p> <ul><li>Published messages are routed to a receive endpoint queue by message type, using exchanges and exchange bindings. A service's receive endpoints do not affect other services or their receive endpoints, as long as they do not share the same queue.</li> <li>Consumers and sagas should have their own receive endpoint, with a unique queue name
<ul><li>Each receive endpoint maps to one queue</li> <li>A queue may contain more than one message type, the message type is used to deliver the message to the appropriate consumer configured on the receive endpoint.</li> <li>If a received message is not handled by a consumer, the skipped message will be moved to a skipped queue, which is named with a _skipped suffix.</li></ul></li> <li>When running multiple instances of the same service
<ul><li>Use the same queue name for each instance</li> <li>Messages from the queue will be load balanced across all instances (the <em>competing consumer</em> pattern)</li></ul></li> <li>If a consumer exception is thrown, the faulted message will be moved to an error queue, which is named with the _error suffix.</li> <li>The number of concurrently processed messages can be up to the <em>PrefetchCount</em>, depending upon the number of cores available.</li> <li>For temporary receive endpoints that should be deleted when the bus is stopped, use <em>TemporaryEndpointDefinition</em> as the receive endpoint definition.</li> <li>To configure <em>PrefetchCount</em> higher than the desired concurrent message count, add <em>UseConcurrencyLimit(n)</em> to the configuration. <em>This must be added before any consumers are configured.</em> Depending upon your consumer duration, higher values may greatly improve overall message throughput.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/usage/transports/rabbitmq.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/30/2020, 1:16:41 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/usage/configuration.html" class="prev">
        Configuration
      </a></span> <span class="next"><a href="/usage/transports/azure-sb.html">
        Azure Service Bus
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0285a886.js" defer></script><script src="/assets/js/3.ed085c94.js" defer></script><script src="/assets/js/144.8a4c62e1.js" defer></script>
  </body>
</html>
